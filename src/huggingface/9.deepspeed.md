**Deep中文文档**

# 训练设置

## 参数解析

一个例子简单明了：

```python
parser = argparse.ArgumentParser(description='My training script.')
parser.add_argument('--local_rank', type=int, default=-1,
                    help='local rank passed from distributed launcher')
# Include DeepSpeed configuration arguments
parser = deepspeed.add_config_arguments(parser)
cmd_args = parser.parse_args()
```

## 训练初始化

还是一个例子：

```python
model_engine, optimizer, _, _ = deepspeed.initialize(args=cmd_args,
                                                     model=net,
                                                     model_parameters=net.parameters())
```

看一下里面的参数：

![image-20230419091554809](9.deepspeed.assets\image-20230419091554809.png)

返回值：

![image-20230419091718073](9.deepspeed.assets\image-20230419091718073.png)

## 分布式初始化

可选的分布式后端初始化与deepspeed.initialize()分开。在用户希望在调用deepspeed.initialize()之前使用torch分布式调用的情况下非常有用，例如在使用模型并行、管道并行或某些数据加载器的情况。

![image-20230419091858240](9.deepspeed.assets\image-20230419091858240.png)

# 推理设置

例子：

```python
engine = deepspeed.init_inference(model=net, config=config)
```

# 训练API

```python
for step, batch in enumerate(data_loader):
    #forward() method
    loss = model_engine(batch)

    #runs backpropagation
    model_engine.backward(loss)

    #weight update
    model_engine.step()
```

# 推理API

```python
for step, batch in enumerate(data_loader):
    #forward() method
    loss = engine(batch)
```

# 模型检查点

DeepSpeed中的激活检查点API可以用来实现一系列与激活检查点有关的内存优化。这些包括在使用模型并行时跨GPU的激活分区、CPU检查点、连续的内存优化等。

# ZeRO



